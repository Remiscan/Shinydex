<?php
require_once './class_Forme.php';

class Pokemon
{
  const ALL_POKEMON = array("zero","bulbasaur","ivysaur","venusaur","charmander","charmeleon","charizard","squirtle","wartortle","blastoise","caterpie","metapod","butterfree","weedle","kakuna","beedrill","pidgey","pidgeotto","pidgeot","rattata","raticate","spearow","fearow","ekans","arbok","pikachu","raichu","sandshrew","sandslash","nidoran-f","nidorina","nidoqueen","nidoran-m","nidorino","nidoking","clefairy","clefable","vulpix","ninetales","jigglypuff","wigglytuff","zubat","golbat","oddish","gloom","vileplume","paras","parasect","venonat","venomoth","diglett","dugtrio","meowth","persian","psyduck","golduck","mankey","primeape","growlithe","arcanine","poliwag","poliwhirl","poliwrath","abra","kadabra","alakazam","machop","machoke","machamp","bellsprout","weepinbell","victreebel","tentacool","tentacruel","geodude","graveler","golem","ponyta","rapidash","slowpoke","slowbro","magnemite","magneton","farfetchd","doduo","dodrio","seel","dewgong","grimer","muk","shellder","cloyster","gastly","haunter","gengar","onix","drowzee","hypno","krabby","kingler","voltorb","electrode","exeggcute","exeggutor","cubone","marowak","hitmonlee","hitmonchan","lickitung","koffing","weezing","rhyhorn","rhydon","chansey","tangela","kangaskhan","horsea","seadra","goldeen","seaking","staryu","starmie","mr-mime","scyther","jynx","electabuzz","magmar","pinsir","tauros","magikarp","gyarados","lapras","ditto","eevee","vaporeon","jolteon","flareon","porygon","omanyte","omastar","kabuto","kabutops","aerodactyl","snorlax","articuno","zapdos","moltres","dratini","dragonair","dragonite","mewtwo","mew","chikorita","bayleef","meganium","cyndaquil","quilava","typhlosion","totodile","croconaw","feraligatr","sentret","furret","hoothoot","noctowl","ledyba","ledian","spinarak","ariados","crobat","chinchou","lanturn","pichu","cleffa","igglybuff","togepi","togetic","natu","xatu","mareep","flaaffy","ampharos","bellossom","marill","azumarill","sudowoodo","politoed","hoppip","skiploom","jumpluff","aipom","sunkern","sunflora","yanma","wooper","quagsire","espeon","umbreon","murkrow","slowking","misdreavus","unown","wobbuffet","girafarig","pineco","forretress","dunsparce","gligar","steelix","snubbull","granbull","qwilfish","scizor","shuckle","heracross","sneasel","teddiursa","ursaring","slugma","magcargo","swinub","piloswine","corsola","remoraid","octillery","delibird","mantine","skarmory","houndour","houndoom","kingdra","phanpy","donphan","porygon2","stantler","smeargle","tyrogue","hitmontop","smoochum","elekid","magby","miltank","blissey","raikou","entei","suicune","larvitar","pupitar","tyranitar","lugia","ho-oh","celebi","treecko","grovyle","sceptile","torchic","combusken","blaziken","mudkip","marshtomp","swampert","poochyena","mightyena","zigzagoon","linoone","wurmple","silcoon","beautifly","cascoon","dustox","lotad","lombre","ludicolo","seedot","nuzleaf","shiftry","taillow","swellow","wingull","pelipper","ralts","kirlia","gardevoir","surskit","masquerain","shroomish","breloom","slakoth","vigoroth","slaking","nincada","ninjask","shedinja","whismur","loudred","exploud","makuhita","hariyama","azurill","nosepass","skitty","delcatty","sableye","mawile","aron","lairon","aggron","meditite","medicham","electrike","manectric","plusle","minun","volbeat","illumise","roselia","gulpin","swalot","carvanha","sharpedo","wailmer","wailord","numel","camerupt","torkoal","spoink","grumpig","spinda","trapinch","vibrava","flygon","cacnea","cacturne","swablu","altaria","zangoose","seviper","lunatone","solrock","barboach","whiscash","corphish","crawdaunt","baltoy","claydol","lileep","cradily","anorith","armaldo","feebas","milotic","castform","kecleon","shuppet","banette","duskull","dusclops","tropius","chimecho","absol","wynaut","snorunt","glalie","spheal","sealeo","walrein","clamperl","huntail","gorebyss","relicanth","luvdisc","bagon","shelgon","salamence","beldum","metang","metagross","regirock","regice","registeel","latias","latios","kyogre","groudon","rayquaza","jirachi","deoxys","turtwig","grotle","torterra","chimchar","monferno","infernape","piplup","prinplup","empoleon","starly","staravia","staraptor","bidoof","bibarel","kricketot","kricketune","shinx","luxio","luxray","budew","roserade","cranidos","rampardos","shieldon","bastiodon","burmy","wormadam","mothim","combee","vespiquen","pachirisu","buizel","floatzel","cherubi","cherrim","shellos","gastrodon","ambipom","drifloon","drifblim","buneary","lopunny","mismagius","honchkrow","glameow","purugly","chingling","stunky","skuntank","bronzor","bronzong","bonsly","mime-jr","happiny","chatot","spiritomb","gible","gabite","garchomp","munchlax","riolu","lucario","hippopotas","hippowdon","skorupi","drapion","croagunk","toxicroak","carnivine","finneon","lumineon","mantyke","snover","abomasnow","weavile","magnezone","lickilicky","rhyperior","tangrowth","electivire","magmortar","togekiss","yanmega","leafeon","glaceon","gliscor","mamoswine","porygon-z","gallade","probopass","dusknoir","froslass","rotom","uxie","mesprit","azelf","dialga","palkia","heatran","regigigas","giratina","cresselia","phione","manaphy","darkrai","shaymin","arceus","victini","snivy","servine","serperior","tepig","pignite","emboar","oshawott","dewott","samurott","patrat","watchog","lillipup","herdier","stoutland","purrloin","liepard","pansage","simisage","pansear","simisear","panpour","simipour","munna","musharna","pidove","tranquill","unfezant","blitzle","zebstrika","roggenrola","boldore","gigalith","woobat","swoobat","drilbur","excadrill","audino","timburr","gurdurr","conkeldurr","tympole","palpitoad","seismitoad","throh","sawk","sewaddle","swadloon","leavanny","venipede","whirlipede","scolipede","cottonee","whimsicott","petilil","lilligant","basculin","sandile","krokorok","krookodile","darumaka","darmanitan","maractus","dwebble","crustle","scraggy","scrafty","sigilyph","yamask","cofagrigus","tirtouga","carracosta","archen","archeops","trubbish","garbodor","zorua","zoroark","minccino","cinccino","gothita","gothorita","gothitelle","solosis","duosion","reuniclus","ducklett","swanna","vanillite","vanillish","vanilluxe","deerling","sawsbuck","emolga","karrablast","escavalier","foongus","amoonguss","frillish","jellicent","alomomola","joltik","galvantula","ferroseed","ferrothorn","klink","klang","klinklang","tynamo","eelektrik","eelektross","elgyem","beheeyem","litwick","lampent","chandelure","axew","fraxure","haxorus","cubchoo","beartic","cryogonal","shelmet","accelgor","stunfisk","mienfoo","mienshao","druddigon","golett","golurk","pawniard","bisharp","bouffalant","rufflet","braviary","vullaby","mandibuzz","heatmor","durant","deino","zweilous","hydreigon","larvesta","volcarona","cobalion","terrakion","virizion","tornadus","thundurus","reshiram","zekrom","landorus","kyurem","keldeo","meloetta","genesect","chespin","quilladin","chesnaught","fennekin","braixen","delphox","froakie","frogadier","greninja","bunnelby","diggersby","fletchling","fletchinder","talonflame","scatterbug","spewpa","vivillon","litleo","pyroar","flabebe","floette","florges","skiddo","gogoat","pancham","pangoro","furfrou","espurr","meowstic","honedge","doublade","aegislash","spritzee","aromatisse","swirlix","slurpuff","inkay","malamar","binacle","barbaracle","skrelp","dragalge","clauncher","clawitzer","helioptile","heliolisk","tyrunt","tyrantrum","amaura","aurorus","sylveon","hawlucha","dedenne","carbink","goomy","sliggoo","goodra","klefki","phantump","trevenant","pumpkaboo","gourgeist","bergmite","avalugg","noibat","noivern","xerneas","yveltal","zygarde","diancie","hoopa","volcanion","rowlet","dartrix","decidueye","litten","torracat","incineroar","popplio","brionne","primarina","pikipek","trumbeak","toucannon","yungoos","gumshoos","grubbin","charjabug","vikavolt","crabrawler","crabominable","oricorio","cutiefly","ribombee","rockruff","lycanroc","wishiwashi","mareanie","toxapex","mudbray","mudsdale","dewpider","araquanid","fomantis","lurantis","morelull","shiinotic","salandit","salazzle","stufful","bewear","bounsweet","steenee","tsareena","comfey","oranguru","passimian","wimpod","golisopod","sandygast","palossand","pyukumuku","type-null","silvally","minior","komala","turtonator","togedemaru","mimikyu","bruxish","drampa","dhelmise","jangmo-o","hakamo-o","kommo-o","tapu-koko","tapu-lele","tapu-bulu","tapu-fini","cosmog","cosmoem","solgaleo","lunala","nihilego","buzzwole","pheromosa","xurkitree","celesteela","kartana","guzzlord","necrozma","magearna","marshadow","poipole","naganadel","stakataka","blacephalon","zeraora","meltan","melmetal","grookey","thwackey","rillaboom","scorbunny","raboot","cinderace","sobble","drizzile","inteleon","skwovet","greedent","rookidee","corvisquire","corviknight","blipbug","dottler","orbeetle","nickit","thievul","gossifleur","eldegoss","wooloo","dubwool","chewtle","drednaw","yamper","boltund","rolycoly","carkol","coalossal","applin","flapple","appletun","silicobra","sandaconda","cramorant","arrokuda","barraskewda","toxel","toxtricity","sizzlipede","centiskorch","clobbopus","grapploct","sinistea","polteageist","hatenna","hattrem","hatterene","impidimp","morgrem","grimmsnarl","obstagoon","perrserker","cursola","sirfetchd","mr-rime","runerigus","milcery","alcremie","falinks","pincurchin","snom","frosmoth","stonjourner","eiscue","indeedee","morpeko","cufant","copperajah","dracozolt","arctozolt","dracovish","arctovish","duraludon","dreepy","drakloak","dragapult","zacian","zamazenta","eternatus","kubfu","urshifu","zarude","regieleki","regidrago","glastrier","spectrier","calyrex");

  const ALL_POKEMON_FR = array("zéro","bulbizarre","herbizarre","florizarre","salamèche","reptincel","dracaufeu","carapuce","carabaffe","tortank","chenipan","chrysacier","papilusion","aspicot","coconfort","dardargnan","roucool","roucoups","roucarnage","rattata","rattatac","piafabec","rapasdepic","abo","arbok","pikachu","raichu","sabelette","sablaireau","nidoran♀","nidorina","nidoqueen","nidoran♂","nidorino","nidoking","mélofée","mélodelfe","goupix","feunard","rondoudou","grodoudou","nosferapti","nosferalto","mystherbe","ortide","rafflésia","paras","parasect","mimitoss","aéromite","taupiqueur","triopikeur","miaouss","persian","psykokwak","akwakwak","férosinge","colossinge","caninos","arcanin","ptitard","têtarte","tartard","abra","kadabra","alakazam","machoc","machopeur","mackogneur","chétiflor","boustiflor","empiflor","tentacool","tentacruel","racaillou","gravalanch","grolem","ponyta","galopa","ramoloss","flagadoss","magnéti","magnéton","canarticho","doduo","dodrio","otaria","lamantine","tadmorv","grotadmorv","kokiyas","crustabri","fantominus","spectrum","ectoplasma","onix","soporifik","hypnomade","krabby","krabboss","voltorbe","électrode","nœunœuf","noadkoko","osselait","ossatueur","kicklee","tygnon","excelangue","smogo","smogogo","rhinocorne","rhinoféros","leveinard","saquedeneu","kangourex","hypotrempe","hypocéan","poissirène","poissoroy","stari","staross","m. mime","insécateur","lippoutou","élektek","magmar","scarabrute","tauros","magicarpe","léviator","lokhlass","métamorph","évoli","aquali","voltali","pyroli","porygon","amonita","amonistar","kabuto","kabutops","ptéra","ronflex","artikodin","électhor","sulfura","minidraco","draco","dracolosse","mewtwo","mew","germignon","macronium","méganium","héricendre","feurisson","typhlosion","kaiminus","crocrodil","aligatueur","fouinette","fouinar","hoothoot","noarfang","coxy","coxyclaque","mimigal","migalos","nostenfer","loupio","lanturn","pichu","mélo","toudoudou","togepi","togetic","natu","xatu","wattouat","lainergie","pharamp","joliflor","marill","azumarill","simularbre","tarpaud","granivol","floravol","cotovol","capumain","tournegrin","héliatronc","yanma","axoloto","maraiste","mentali","noctali","cornèbre","roigada","feuforêve","zarbi","qulbutoké","girafarig","pomdepik","foretress","insolourdo","scorplane","steelix","snubbull","granbull","qwilfish","cizayox","caratroc","scarhino","farfuret","teddiursa","ursaring","limagma","volcaropod","marcacrin","cochignon","corayon","rémoraid","octillery","cadoizo","démanta","airmure","malosse","démolosse","hyporoi","phanpy","donphan","porygon2","cerfrousse","queulorior","debugant","kapoera","lippouti","élekid","magby","écrémeuh","leuphorie","raikou","entei","suicune","embrylex","ymphect","tyranocif","lugia","ho-oh","celebi","arcko","massko","jungko","poussifeu","galifeu","braségali","gobou","flobio","laggron","medhyèna","grahyèna","zigzaton","linéon","chenipotte","armulys","charmillon","blindalys","papinox","nénupiot","lombre","ludicolo","grainipiot","pifeuil","tengalice","nirondelle","hélédelle","goélise","bekipan","tarsal","kirlia","gardevoir","arakdo","maskadra","balignon","chapignon","parécool","vigoroth","monaflèmit","ningale","ninjask","munja","chuchmur","ramboum","brouhabam","makuhita","hariyama","azurill","tarinor","skitty","delcatty","ténéfix","mysdibule","galekid","galegon","galeking","méditikka","charmina","dynavolt","élecsprint","posipi","négapi","muciole","lumivole","rosélia","gloupti","avaltout","carvanha","sharpedo","wailmer","wailord","chamallot","camérupt","chartor","spoink","groret","spinda","kraknoix","vibraninf","libégon","cacnea","cacturne","tylton","altaria","mangriff","séviper","séléroc","solaroc","barloche","barbicha","écrapince","colhomard","balbuto","kaorine","lilia","vacilys","anorith","armaldo","barpau","milobellus","morphéo","kecleon","polichombr","branette","skelénox","téraclope","tropius","éoko","absol","okéoké","stalgamin","oniglali","obalie","phogleur","kaimorse","coquiperl","serpang","rosabyss","relicanth","lovdisc","draby","drackhaus","drattak","terhal","métang","métalosse","regirock","regice","registeel","latias","latios","kyogre","groudon","rayquaza","jirachi","deoxys","tortipouss","boskara","torterra","ouisticram","chimpenfeu","simiabraz","tiplouf","prinplouf","pingoléon","étourmi","étourvol","étouraptor","keunotor","castorno","crikzik","mélokrik","lixy","luxio","luxray","rozbouton","roserade","kranidos","charkos","dinoclier","bastiodon","cheniti","cheniselle","papilord","apitrini","apireine","pachirisu","mustébouée","mustéflott","ceribou","ceriflor","sancoki","tritosor","capidextre","baudrive","grodrive","laporeille","lockpin","magirêve","corboss","chaglam","chaffreux","korillon","moufouette","moufflair","archéomire","archéodong","manzaï","mime jr.","ptiravi","pijako","spiritomb","griknot","carmache","carchacrok","goinfrex","riolu","lucario","hippopotas","hippodocus","rapion","drascore","cradopaud","coatox","vortente","écayon","luminéon","babimanta","blizzi","blizzaroi","dimoret","magnézone","coudlangue","rhinastoc","bouldeneu","élekable","maganon","togekiss","yanmega","phyllali","givrali","scorvol","mammochon","porygon-z","gallame","tarinorme","noctunoir","momartik","motisma","créhelf","créfollet","créfadet","dialga","palkia","heatran","regigigas","giratina","cresselia","phione","manaphy","darkrai","shaymin","arceus","victini","vipélierre","lianaja","majaspic","gruikui","grotichon","roitiflam","moustillon","mateloutre","clamiral","ratentif","miradar","ponchiot","ponchien","mastouffe","chacripan","léopardus","feuillajou","feuiloutan","flamajou","flamoutan","flotajou","flotoutan","munna","mushana","poichigeon","colombeau","déflaisan","zébibron","zéblitz","nodulithe","géolithe","gigalithe","chovsourir","rhinolove","rototaupe","minotaupe","nanméouïe","charpenti","ouvrifier","bétochef","tritonde","batracné","crapustule","judokrak","karaclée","larveyette","couverdure","manternel","venipatte","scobolide","brutapode","doudouvet","farfaduvet","chlorobule","fragilady","bargantua","mascaïman","escroco","crocorible","darumarond","darumacho","maracachi","crabicoque","crabaraque","baggiguane","baggaïd","cryptéro","tutafeh","tutankafer","carapagos","mégapagos","arkéapti","aéroptéryx","miamiasme","miasmax","zorua","zoroark","chinchidou","pashmilla","scrutella","mesmérella","sidérella","nucléos","méios","symbios","couaneton","lakmécygne","sorbébé","sorboul","sorbouboul","vivaldaim","haydaim","emolga","carabing","lançargot","trompignon","gaulet","viskuse","moyade","mamanbo","statitik","mygavolt","grindur","noacier","tic","clic","cliticlic","anchwatt","lampéroie","ohmassacre","lewsor","neitram","funécire","mélancolux","lugulabre","coupenotte","incisache","tranchodon","polarhume","polagriffe","hexagel","escargaume","limaspeed","limonde","kungfouine","shaofouine","drakkarmin","gringolem","golemastoc","scalpion","scalproie","frison","furaiglon","gueriaigle","vostourno","vaututrice","aflamanoir","fermite","solochi","diamat","trioxhydre","pyronille","pyrax","cobaltium","terrakium","viridium","boréas","fulguris","reshiram","zekrom","démétéros","kyurem","keldeo","meloetta","genesect","marisson","boguérisse","blindépique","feunnec","roussil","goupelin","grenousse","croâporal","amphinobi","sapereau","excavarenne","passerouge","braisillon","flambusard","lépidonille","pérégrain","prismillon","hélionceau","némélios","flabébé","floette","florges","cabriolaine","chevroum","pandespiègle","pandarbare","couafarel","psystigri","mistigrix","monorpale","dimoclès","exagide","fluvetin","cocotine","sucroquin","cupcanaille","sepiatop","sepiatroce","opermine","golgopathe","venalgue","kravarech","flingouste","gamblast","galvaran","iguolta","ptyranidur","rexillius","amagara","dragmara","nymphali","brutalibré","dedenne","strassie","mucuscule","colimucus","muplodocus","trousselin","brocélôme","desséliande","pitrouille","banshitrouye","grelaçon","séracrawl","sonistrelle","bruyverne","xerneas","yveltal","zygarde","diancie","hoopa","volcanion","brindibou","efflèche","archéduc","flamiaou","matoufeu","félinferno","otaquin","otarlette","oratoria","picassaut","piclairon","bazoucan","manglouton","argouste","larvibule","chrysapile","lucanon","crabagarre","crabominable","plumeline","bombydou","rubombelle","rocabot","lougaroc","froussardine","vorastérie","prédastérie","tiboudet","bourrinos","araqua","tarenbulle","mimantis","floramantis","spododo","lampignon","tritox","malamandre","nounourson","chelours","croquine","candine","sucreine","guérilande","gouroutan","quartermac","sovkipou","sarmuraï","bacabouh","trépassable","concombaffe","type:0","silvallié","météno","dodoala","boumata","togedemaru","mimiqui","denticrisse","draïeul","sinistrail","bébécaille","écaïd","ékaïser","tokorico","tokotoro","tokopiyon","tokopisco","cosmog","cosmovum","solgaleo","lunala","zéroïd","mouscoto","cancrelove","câblifère","bamboiselle","katagami","engloutyran","necrozma","magearna","marshadow","vémini","mandrillon","ama-ama","pierroteknik","zeraora","meltan","melmetal","ouistempo","badabouin","gorythmic","flambino","lapyro","pyrobut","larméléon","arrozard","lézargus","rongourmand","rongrigou","minisange","bleuseille","corvaillus","larvadar","coléodôme","astronelle","goupilou","roublenard","tournicoton","blancoton","moumouton","moumouflon","khélocrok","torgamord","voltoutou","fulgudog","charbi","wagomine","monthracite","verpom","pomdrapi","dratatin","dunaja","dunaconda","nigosier","embrochet","hastacuda","toxizap","salarsen","grillepattes","scolocendre","poulpaf","krakos","théffroi","polthégeist","bibichut","chapotus","sorcilence","grimalin","fourbelin","angoliath","ixon","berserkatt","corayôme","palarticho","m. glaquette","tutétékri","crèmy","charmilly","hexadron","wattapik","frissonille","beldeneige","dolman","bekaglaçon","wimessir","morpeko","charibari","pachyradjah","galvagon","galvagla","hydragon","hydragla","duralugon","fantyrm","dispareptil","lanssorien","zacian","zamazenta","éthernatos","wushours","shifours","zarude","regieleki","regidrago","blizzeval","spectreval","sylveroy");

  public $dexid;
  public $name;
  public $namefr;
  public $formes = [];
  private $formes_ids = [];

  function __construct($id, $name, $sprites)
  {
    $this->dexid = $id;
    $this->name = $name;
    $this->namefr = Pokemon::ALL_POKEMON_FR[$id];

    forEach($sprites as $s)
    {
      try {
        $forme = new Forme(new Sprite($s), $id);

        if (!file_exists('./sprites-home/big/' . str_replace('_n.png', '_r.png', $s)) && $this->dexid != 869)
        $forme->noShiny = true;

        if (file_exists('./sprites-home/big/' . str_replace('_f_n.png', '_b_n.png', $s)))
          $forme->hasBackside == true;

        $formeCaracs = [
          $forme->form,
          $forme->gender,
          $forme->gigamax ? 'g' : 'n',
          $forme->candy
        ];
        $spriteid = implode('_', $formeCaracs);

        if (!in_array($spriteid, $this->formes_ids))
        {
          $this->formes_ids[] = $spriteid;
          $this->formes[] = $forme;
        }
      } catch (Exception $e) {
        continue;
      }
    }
  }

  public function getSprite(Forme $forme, $options = null)
  {
    if ($options === null)
    {
      $options = (object) [
        'shiny' => false,
        'big' => true,
        'backside' => false
      ];
    }

    if (!is_object($options)) throw new Exception('options must be an object');

    $shiny = property_exists($options, 'shiny') ? $options->shiny : false;
    $shinySuffix = $shiny ? 'r' : 'n';
    $big = property_exists($options, 'big') ? $options->big : true;
    $size = $big ? 'big' : 'small';
    $sizePrefix = 'capture';

    $side = (property_exists($forme, 'hasBackside') && property_exists($options, 'backside') && $options->backside) ? 'b' : 'f';

    $formToConsider = ($shiny && $this->dexid == 869) ? 0 : $forme->form;

    $spriteCaracs = [
      './sprites-home/' . $size . '/poke',
      $sizePrefix,
      str_pad($this->dexid, 4, "0", STR_PAD_LEFT),
      str_pad($formToConsider, 3, "0", STR_PAD_LEFT),
      $forme->gender,
      $forme->gigamax ? 'g' : 'n',
      str_pad($forme->candy, 8, "0", STR_PAD_LEFT),
      $side,
      $shinySuffix
    ];

    $spriteUrl = implode('_', $spriteCaracs) . '.png';

    if (property_exists($forme, 'noShiny') && $forme->noShiny == true && $shiny)
      $spriteUrl = './sprites-home/' . $size . '/poke_' . $sizePrefix . '_0000_000_uk_n_00000000_f_n.png';

    return $spriteUrl;
  }
}